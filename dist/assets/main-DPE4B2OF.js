import{a,j as e,R as H}from"./react-DfUtXkZV.js";import{R as k}from"./react-dom-gDMPjaGT.js";import{u as F,B as P}from"./react-router-dom-DvDRy6SF.js";import{B as b,g as j,i as U,h as L,r as z,k as J,t as $,C as N,f as q,p as E,a as _,S as Q}from"./ethers-BgGAy1Gq.js";import{Q as W}from"./qrcode.react-D-n_gz0T.js";import{b as G,c as T}from"./react-router-BNGNygTf.js";import"./scheduler-C323NY8X.js";import"./@remix-run-BIrGyY9Z.js";import"./@noble-a_c5q8x8.js";import"./@adraffy-CxNvlRkB.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}})();function K({onAddressConnected:d}){const[s,l]=a.useState(null);async function i(){if(!window.ethereum){alert("请安装 MetaMask");return}try{const n=await new b(window.ethereum).send("eth_requestAccounts",[]);if(n.length===0){alert("未检测到账户，请检查 MetaMask 配置");return}const r=j(n[0]);l(r),d(r)}catch(t){console.error("钱包连接失败:",t),alert("钱包连接失败，请稍后重试")}}return a.useEffect(()=>{if(window.ethereum){const t=n=>{if(n.length>0){const r=j(n[0]);l(r),d(r)}else l(null),d(null)};return window.ethereum.on("accountsChanged",t),()=>{window.ethereum.removeListener("accountsChanged",t)}}},[]),e.jsx("div",{className:"p-4 border rounded-xl bg-gray-50 shadow",children:s?e.jsxs("p",{className:"text-green-700 font-semibold",children:["已连接: ",s]}):e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:i,children:"连接钱包"})})}function V({onBlindGenerated:d}){const[s,l]=a.useState(""),[i,t]=a.useState(""),[n,r]=a.useState(""),[h,c]=a.useState(""),[y,p]=a.useState(""),x=async()=>{if(!window.ethereum)return alert("请安装 MetaMask");if(!s||!i)return alert("请输入用户 B 地址和说明");try{const g=await(await new b(window.ethereum).getSigner()).getAddress(),o=Date.now(),m={target:j(i),operator:j(g),description:s,timestamp:o},w=JSON.stringify(m),M=U(w),v=L(z(32)),S=J($(M+v)),R={blindedHash:S,payload:m,blind:v},B=new TextEncoder().encode(JSON.stringify(R)),I=btoa(String.fromCharCode(...B)),D=`${window.location.origin}/sepolia-blind-sign/sign?data=${I}`;r(v),c(S),p(D),d&&d({blindedHash:S,blindFactor:v,payload:m})}catch(u){console.error("生成失败",u),alert("生成失败，请检查信息或钱包连接")}};return e.jsxs("div",{className:"p-4 bg-white border rounded-xl shadow w-full max-w-xl space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"生成盲签请求二维码"}),e.jsx("input",{className:"w-full p-2 border rounded",placeholder:"请输入用户 B 的钱包地址",value:i,onChange:u=>t(u.target.value)}),e.jsx("textarea",{className:"w-full p-2 border rounded",rows:3,placeholder:"描述授权用途（如：授权我代管资产）",value:s,onChange:u=>l(u.target.value)}),e.jsx("button",{onClick:x,className:"bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700",children:"生成授权二维码"}),h&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("h3",{className:"text-md font-medium",children:"二维码：请用户 B 扫码授权"}),e.jsx(W,{value:y,size:256}),e.jsx("p",{className:"text-sm text-gray-500 break-all",children:y}),e.jsxs("details",{className:"text-xs bg-gray-100 p-2 rounded break-words",children:[e.jsx("summary",{className:"cursor-pointer font-semibold",children:"查看请求 JSON"}),e.jsx("pre",{children:JSON.stringify({blindedHash:h,blindFactor:n,targetAddress:i,description:s},null,2)})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"blindedHash:"})," ",h]}),e.jsxs("p",{children:[e.jsx("strong",{children:"盲因子 (blindFactor):"})," ",n]})]})]})]})}const A=JSON.parse('[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"ECDSAInvalidSignature","type":"error"},{"inputs":[{"internalType":"uint256","name":"length","type":"uint256"}],"name":"ECDSAInvalidSignatureLength","type":"error"},{"inputs":[{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"ECDSAInvalidSignatureS","type":"error"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"allowance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientAllowance","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"}],"name":"ERC20InsufficientBalance","type":"error"},{"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC20InvalidApprover","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC20InvalidReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC20InvalidSender","type":"error"},{"inputs":[{"internalType":"address","name":"spender","type":"address"}],"name":"ERC20InvalidSpender","type":"error"},{"inputs":[{"internalType":"uint256","name":"deadline","type":"uint256"}],"name":"ERC2612ExpiredSignature","type":"error"},{"inputs":[{"internalType":"address","name":"signer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"name":"ERC2612InvalidSigner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"currentNonce","type":"uint256"}],"name":"InvalidAccountNonce","type":"error"},{"inputs":[],"name":"InvalidShortString","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"inputs":[{"internalType":"string","name":"str","type":"string"}],"name":"StringTooLong","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[],"name":"EIP712DomainChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"PermitUsed","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"TokensMinted","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[],"name":"DOMAIN_SEPARATOR","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"pure","type":"function"},{"inputs":[],"name":"eip712Domain","outputs":[{"internalType":"bytes1","name":"fields","type":"bytes1"},{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"version","type":"string"},{"internalType":"uint256","name":"chainId","type":"uint256"},{"internalType":"address","name":"verifyingContract","type":"address"},{"internalType":"bytes32","name":"salt","type":"bytes32"},{"internalType":"uint256[]","name":"extensions","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"nonces","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint256","name":"deadline","type":"uint256"},{"internalType":"uint8","name":"v","type":"uint8"},{"internalType":"bytes32","name":"r","type":"bytes32"},{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"permit","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"uint256","name":"deadline","type":"uint256"},{"internalType":"uint8","name":"v","type":"uint8"},{"internalType":"bytes32","name":"r","type":"bytes32"},{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"permitWithEvent","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"}]'),C="0xb39a936f24a1878642855de4e4af931723c30484";function X(){const[d,s]=a.useState(""),[l,i]=a.useState([]),[t,n]=a.useState({}),[r,h]=a.useState("");a.useEffect(()=>{c()},[]);const c=async()=>{if(!window.ethereum)return alert("请安装 MetaMask");const p=new b(window.ethereum),u=await(await p.getSigner()).getAddress();s(u);const f=new N(C,A,p),g=await f.getAuthorizedTargets(u);i(g);const o={};for(const m of g){const w=await f.getBalance(m);o[m]=q(w)}n(o)},y=async(p,x,u)=>{if(!window.ethereum)return alert("请安装 MetaMask");const g=await new b(window.ethereum).getSigner(),m=await new N(C,A,g).transferFromAuthorized(p,x,E(u));await m.wait(),h(`成功转账，交易哈希：${m.hash}`),c()};return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded-xl shadow mt-10 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"授权资产管理面板"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["当前操作人地址：",d]}),l.length===0?e.jsx("p",{className:"text-gray-500",children:"你还没有获得任何用户的授权。"}):l.map(p=>e.jsxs("div",{className:"border p-4 rounded space-y-2 bg-gray-50",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"用户地址:"})," ",p]}),e.jsxs("p",{children:[e.jsx("strong",{children:"余额:"})," ",t[p]," ETH"]}),e.jsx(Y,{from:p,onTransfer:y})]},p)),r&&e.jsx("div",{className:"p-3 bg-green-100 border rounded text-green-700 text-sm",children:r})]})}function Y({from:d,onTransfer:s}){const[l,i]=a.useState(""),[t,n]=a.useState("");return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"w-full p-2 border rounded",placeholder:"转账目标地址",value:l,onChange:r=>i(r.target.value)}),e.jsx("input",{className:"w-full p-2 border rounded",placeholder:"转账金额（ETH）",value:t,onChange:r=>n(r.target.value)}),e.jsx("button",{onClick:()=>s(d,l,t),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"代表用户转账"})]})}function Z(){const[d]=F(),[s,l]=a.useState(""),[i,t]=a.useState(null),[n,r]=a.useState("");a.useEffect(()=>{const c=d.get("data");if(c)try{const y=atob(c),p=JSON.parse(y);l(p.blindedHash)}catch(y){console.error("解析二维码失败",y)}},[d]);const h=async()=>{if(!window.ethereum)return alert("请安装 MetaMask");try{const y=await new b(window.ethereum).getSigner(),p=await y.getAddress();r(p);const x=_(s),u=await y.signMessage(x);t(Q.from(u))}catch(c){console.error("签名失败",c),alert("签名失败，请检查钱包连接")}};return e.jsxs("div",{className:"max-w-xl mx-auto p-6 bg-white shadow-md rounded-xl mt-10 space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-center",children:"签名页面"}),e.jsx("p",{className:"text-center text-gray-600",children:"这里可以展示签名数据及操作"}),s?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"你将对以下盲化消息签名："}),e.jsx("pre",{className:"bg-gray-100 p-2 rounded text-xs break-words",children:s}),e.jsx("button",{onClick:h,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"使用钱包签名"})]}):e.jsx("p",{className:"text-red-600 text-center",children:"未获取到签名数据，请检查二维码"}),i&&e.jsxs("div",{className:"space-y-2 mt-4 text-sm text-gray-700",children:[e.jsx("h3",{className:"font-semibold",children:"签名成功："}),e.jsxs("p",{children:[e.jsx("strong",{children:"签名者:"})," ",n]}),e.jsxs("p",{children:[e.jsx("strong",{children:"v:"})," ",i.v]}),e.jsxs("p",{children:[e.jsx("strong",{children:"r:"})," ",i.r]}),e.jsxs("p",{children:[e.jsx("strong",{children:"s:"})," ",i.s]}),e.jsx("p",{className:"text-xs mt-2 text-gray-500 text-center",children:"请将以上数据发送回用户 A"})]})]})}const ee="0xb39a936f24a1878642855de4e4af931723c30484",te=["function executeTransfer(address from, address to, uint256 amount, bytes32 messageHash, uint8 v, bytes32 r, bytes32 s) external"];function O(){const[d,s]=a.useState(""),[l,i]=a.useState(""),[t,n]=a.useState(""),[r,h]=a.useState(""),[c,y]=a.useState(""),[p,x]=a.useState(""),[u,f]=a.useState(""),g=async()=>{try{if(!window.ethereum)return alert("请安装MetaMask");const m=await new b(window.ethereum).getSigner();await(await new N(ee,te,m).executeTransfer(d,l,E(t),r,parseInt(c),p,u)).wait(),alert("转账成功")}catch(o){console.error("转账失败",o),alert("转账失败，请检查参数或签名是否有效")}};return e.jsxs("div",{className:"max-w-xl mx-auto p-4 bg-white shadow rounded space-y-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"使用签名授权执行转账"}),e.jsx("input",{className:"w-full border p-2",placeholder:"From (用户B地址)",value:d,onChange:o=>s(o.target.value)}),e.jsx("input",{className:"w-full border p-2",placeholder:"To (接收地址)",value:l,onChange:o=>i(o.target.value)}),e.jsx("input",{className:"w-full border p-2",placeholder:"Amount (ETH)",value:t,onChange:o=>n(o.target.value)}),e.jsx("input",{className:"w-full border p-2",placeholder:"messageHash",value:r,onChange:o=>h(o.target.value)}),e.jsx("input",{className:"w-full border p-2",placeholder:"v",value:c,onChange:o=>y(o.target.value)}),e.jsx("input",{className:"w-full border p-2",placeholder:"r",value:p,onChange:o=>x(o.target.value)}),e.jsx("input",{className:"w-full border p-2",placeholder:"s",value:u,onChange:o=>f(o.target.value)}),e.jsx("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:"执行授权转账"})]})}function ne(){const[d,s]=a.useState(null),[l,i]=a.useState(null);return e.jsxs("div",{className:"min-h-screen bg-gray-100 p-6 space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-center",children:"Sepolia 盲签名授权系统"}),e.jsx(K,{onAddressConnected:s}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-center text-gray-700",children:["当前用户地址：",d]}),e.jsx(V,{onBlindGenerated:i})]}),e.jsx(O,{})]})}function ae(){return e.jsx(P,{children:e.jsx("div",{className:"min-h-screen p-6 bg-gray-50",children:e.jsxs(G,{children:[e.jsx(T,{path:"/",element:e.jsx(ne,{})}),e.jsx(T,{path:"/sign",element:e.jsx(Z,{})}),e.jsx(T,{path:"/dashboard",element:e.jsx(X,{})}),e.jsx(T,{path:"/execute",element:e.jsx(O,{})})," "]})})})}k.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(ae,{})}));
